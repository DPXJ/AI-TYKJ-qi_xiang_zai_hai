# 地块气象智能体 - 功能测试指南

## 🎯 测试目标

验证对话流交互模式下的所有新功能是否正常运行。

---

## 🚀 快速启动

### 1. 启动演示系统

```bash
# 方式一：双击 start.bat
start.bat

# 方式二：直接打开
在浏览器中打开 index.html
```

### 2. 进入地块气象智能体

导航路径：**AI → 气象灾害预警 → 地块气象灾害预报**

---

## ✅ 测试用例清单

### 测试用例 1：首次进入体验

**操作步骤：**
1. 首次进入地块气象智能体页面
2. 观察页面展示内容

**预期结果：**
- ✅ 显示 AI 欢迎消息："您好！我是地块气象智能体..."
- ✅ 显示蓝色的"生成地块报告"按钮（居中）
- ✅ 按钮有渐变色和阴影效果
- ✅ 按钮图标为文档图标

**验证点：**
- [ ] 欢迎消息正确显示
- [ ] 按钮样式符合设计规范
- [ ] 按钮悬停有向上浮动效果

---

### 测试用例 2：触发地块选择

**操作步骤：**
1. 点击"生成地块报告"按钮
2. 观察页面变化

**预期结果：**
- ✅ 按钮消失
- ✅ 显示地块选择器组件
- ✅ 选择器包含标题："请选择要查询的地块："

**验证点：**
- [ ] 按钮点击响应正常
- [ ] 选择器平滑出现
- [ ] 自动滚动到底部

---

### 测试用例 3：地块选择器 - 推荐功能

**操作步骤：**
1. 观察地块选择器中的第一个地块项
2. 检查推荐标识

**预期结果：**
- ✅ 第一个地块有"离我最近"斜角标
- ✅ 推荐地块背景为蓝色渐变
- ✅ 推荐地块有 2px 蓝色边框
- ✅ 斜角标为白色文字、蓝色背景、略微旋转

**验证点：**
- [ ] 推荐标识显示正常
- [ ] 推荐地块样式符合设计
- [ ] 斜角标位置正确（右上角）

**注意事项：**
- 如果浏览器未授权定位权限，将不显示推荐标识
- 可以在控制台查看是否成功获取位置

---

### 测试用例 4：地块选择器 - 地块信息展示

**操作步骤：**
1. 观察每个地块项的内容

**预期结果：**
每个地块项包含：
- ✅ **第一行**：基地名称 - 地块名称（深色，加粗，15px）
  - 例如："腾跃示范基地 - 1号地块"
- ✅ **第二行**：作物名称（浅灰色，13px）
  - 例如："辣椒"

**验证点：**
- [ ] 信息层级清晰
- [ ] 字体大小和颜色符合规范
- [ ] 多行布局正确

---

### 测试用例 5：地块选择器 - 折叠展开功能

**前提条件：** 确保有超过 5 个地块

**操作步骤：**
1. 观察初始状态
2. 点击"查看更多"按钮
3. 再次点击（变为"收起"）

**预期结果：**
- ✅ **初始状态**：显示 1 个推荐 + 5 个普通地块
- ✅ 底部显示"查看更多 ▼"按钮
- ✅ **展开后**：显示所有地块
- ✅ 按钮文字变为"收起 ▲"
- ✅ 箭头图标旋转 180°
- ✅ **收起后**：恢复到初始状态

**验证点：**
- [ ] 折叠/展开动画流畅
- [ ] 按钮文字和图标正确切换
- [ ] 隐藏的地块项正确显示/隐藏

---

### 测试用例 6：地块选择器 - 交互效果

**操作步骤：**
1. 鼠标悬停在任意地块项上
2. 观察效果

**预期结果：**
- ✅ 背景色变为浅蓝色 `#f0f7ff`
- ✅ 边框颜色变为蓝色 `#3b82f6`
- ✅ 地块项向右平移 4px
- ✅ 鼠标指针变为手型（cursor: pointer）
- ✅ 过渡动画流畅（0.3s ease）

**验证点：**
- [ ] 悬停效果符合设计
- [ ] 动画过渡流畅
- [ ] 推荐地块悬停效果也正常

---

### 测试用例 7：选择地块并生成报告

**操作步骤：**
1. 点击任意地块项
2. 观察整个生成流程

**预期结果：**

**步骤 1 - 选择器消失**
- ✅ 地块选择器立即消失

**步骤 2 - 用户消息**（延迟 0.5s）
- ✅ 显示用户选择的地块名称
- ✅ 消息在右侧，蓝色气泡

**步骤 3 - 加载状态**（立即）
- ✅ AI 头像显示
- ✅ 显示加载文字："正在为您生成 X号地块 的报告，请稍候..."
- ✅ 三个点的跳动动画
- ✅ 持续约 1.5 秒

**步骤 4 - 生成完成**（1.5s 后）
- ✅ 加载消息消失
- ✅ 显示气象结果预览卡片
- ✅ 延迟 0.3s 后显示"生成地块报告"按钮

**验证点：**
- [ ] 流程顺序正确
- [ ] 时间节奏合理
- [ ] 加载动画流畅
- [ ] 自动滚动到底部

---

### 测试用例 8：气象结果预览卡片 - 结构验证

**操作步骤：**
1. 观察生成的预览卡片

**预期结果：**

**时间戳**（卡片上方）
- ✅ 显示格式："刚刚" / "14:30" / "昨天" 等
- ✅ 居中显示
- ✅ 浅灰色，12px

**卡片头部**
- ✅ **左侧**：
  - 基地名称 - 地块名称（16px，加粗）
  - 作物名称（绿色 Badge）
- ✅ **右侧**：
  - 预警等级图标（🔴/🟠/🟡/🔵）
  - 预警等级文字（红色/橙色/黄色/蓝色背景）

**简要分析区**
- ✅ 浅蓝色背景
- ✅ 左侧蓝色竖线装饰
- ✅ 2-3 行分析文字
- ✅ 字号 14px，行高 1.6

**卡片底部**
- ✅ "查看完整报告"文字
- ✅ 右箭头图标
- ✅ 蓝色文字
- ✅ 右对齐

**验证点：**
- [ ] 所有元素都正确显示
- [ ] 布局符合设计规范
- [ ] 颜色符合预警等级

---

### 测试用例 9：气象结果预览卡片 - 交互效果

**操作步骤：**
1. 鼠标悬停在预览卡片上
2. 点击卡片

**预期结果：**

**悬停效果**
- ✅ 卡片向上浮动 2px
- ✅ 阴影增强
- ✅ 右箭头图标向右平移 4px
- ✅ 过渡动画流畅（0.3s）

**点击效果**
- ✅ 跳转到气象详情页
- ✅ 显示完整的 AI 分析报告

**验证点：**
- [ ] 悬停动画流畅
- [ ] 点击跳转正常
- [ ] 详情页数据正确

---

### 测试用例 10：生成报告按钮再次出现

**操作步骤：**
1. 等待预览卡片生成完成后 0.3s

**预期结果：**
- ✅ 在对话流底部再次出现"生成地块报告"按钮
- ✅ 按钮样式与首次一致
- ✅ 可以再次点击触发新的生成流程

**验证点：**
- [ ] 按钮正确出现
- [ ] 可以重复触发流程
- [ ] 形成完整闭环

---

### 测试用例 11：多次生成报告

**操作步骤：**
1. 点击"生成地块报告"按钮
2. 选择第一个地块，等待生成完成
3. 再次点击"生成地块报告"按钮
4. 选择第二个地块，等待生成完成

**预期结果：**
- ✅ 对话流中显示两个预览卡片
- ✅ 每个卡片都有独立的时间戳
- ✅ 可以分别点击查看详情
- ✅ 最底部始终有"生成地块报告"按钮

**验证点：**
- [ ] 支持多次生成
- [ ] 历史记录保留
- [ ] 滚动正常

---

### 测试用例 12：退出重进 - 状态持久化

**操作步骤：**
1. 生成至少一个地块报告
2. 退出地块气象智能体页面（返回上一级）
3. 重新进入地块气象智能体页面

**预期结果：**
- ✅ 自动显示上次生成的预览卡片
- ✅ 显示"生成地块报告"按钮
- ✅ 不显示欢迎消息
- ✅ 可以直接点击卡片查看详情

**验证点：**
- [ ] 状态正确恢复
- [ ] 历史报告可访问
- [ ] 可以继续生成新报告

---

### 测试用例 13：时间戳格式化

**操作步骤：**
1. 生成一个报告，观察时间戳
2. 等待 2 分钟后刷新页面
3. 模拟不同时间场景（通过修改代码）

**预期结果：**
- ✅ **< 1 分钟**：显示"刚刚"
- ✅ **< 1 小时**：显示"X分钟前"
- ✅ **当天**：显示"14:30"格式
- ✅ **昨天**：显示"昨天"
- ✅ **< 7 天**：显示"X天前"
- ✅ **≥ 7 天**：显示"12月25日"格式

**验证点：**
- [ ] 时间格式化正确
- [ ] 显示符合中文习惯

---

### 测试用例 14：响应式布局（移动端）

**操作步骤：**
1. 调整浏览器宽度至 < 400px
2. 观察各组件的响应式变化

**预期结果：**

**预览卡片**
- ✅ 头部改为纵向布局
- ✅ 预警标识换行显示
- ✅ 内容宽度自适应

**地块选择器**
- ✅ 推荐标签字号缩小
- ✅ 地块项宽度自适应

**生成按钮**
- ✅ 宽度自适应
- ✅ 保持居中

**验证点：**
- [ ] 小屏幕下布局不错乱
- [ ] 文字可读性良好
- [ ] 按钮可点击

---

### 测试用例 15：预警等级颜色验证

**操作步骤：**
1. 多次生成报告（随机获得不同预警等级）
2. 观察不同等级的颜色显示

**预期结果：**

| 预警等级 | 图标 | 背景色 | 文字色 |
|---------|------|--------|--------|
| 红色预警 | 🔴 | `#fee2e2` | `#dc2626` |
| 橙色预警 | 🟠 | `#ffedd5` | `#ea580c` |
| 黄色预警 | 🟡 | `#fef3c7` | `#f59e0b` |
| 蓝色预警 | 🔵 | `#dbeafe` | `#2563eb` |

**验证点：**
- [ ] 颜色符合设计规范
- [ ] 图标正确显示
- [ ] 对比度足够清晰

---

## 🐛 常见问题排查

### 问题 1：推荐地块不显示

**原因：** 浏览器未授权定位权限

**解决方案：**
1. 检查浏览器地址栏的定位图标
2. 手动授权定位权限
3. 刷新页面

---

### 问题 2：地块选择器不显示

**排查步骤：**
1. 打开浏览器控制台（F12）
2. 检查是否有 JavaScript 错误
3. 确认 `getAllPlots()` 函数返回数据
4. 检查 DOM 中是否有 `.block-selector` 元素

---

### 问题 3：点击卡片无反应

**排查步骤：**
1. 检查控制台是否有错误
2. 确认 `showWeatherDetailPage()` 函数是否被调用
3. 检查 JSON.stringify 是否正确
4. 验证数据格式转换逻辑

---

### 问题 4：样式显示不正常

**排查步骤：**
1. 确认 CSS 文件已加载
2. 检查浏览器缓存（Ctrl+Shift+R 强制刷新）
3. 使用开发者工具检查元素样式
4. 确认 CSS 选择器正确

---

## 📊 测试结果记录表

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 测试用例 1 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 2 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 3 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 4 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 5 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 6 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 7 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 8 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 9 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 10 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 11 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 12 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 13 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 14 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |
| 测试用例 15 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 |  |

---

## 🎥 演示视频脚本

### 录制建议

**时长**：2-3 分钟  
**分辨率**：1920x1080  
**帧率**：30fps

### 脚本内容

**0:00-0:10 - 开场**
- 展示项目首页
- 导航至"AI → 气象灾害预警 → 地块气象灾害预报"

**0:10-0:20 - 首次体验**
- 展示欢迎消息
- 展示"生成地块报告"按钮
- 鼠标悬停展示动画效果

**0:20-0:40 - 地块选择**
- 点击按钮，呼出选择器
- 展示"离我最近"推荐标识
- 展示多行布局信息
- 点击"查看更多"按钮

**0:40-1:00 - 生成报告**
- 选择一个地块
- 展示加载动画
- 展示预览卡片生成

**1:00-1:20 - 卡片详情**
- 展示卡片各个部分
- 鼠标悬停展示动画
- 点击卡片跳转详情页

**1:20-1:40 - 多次生成**
- 返回对话页
- 再次点击"生成地块报告"
- 选择另一个地块
- 展示多个卡片并存

**1:40-2:00 - 状态持久化**
- 退出页面
- 重新进入
- 展示历史报告保留

**2:00-2:20 - 响应式展示**
- 调整浏览器宽度
- 展示移动端适配效果

**2:20-2:30 - 结束**
- 展示完整的对话流
- 淡出

---

## 📝 测试报告模板

### 测试环境

- **浏览器**：Chrome / Firefox / Safari / Edge
- **版本**：
- **操作系统**：Windows / macOS / Linux
- **屏幕分辨率**：
- **测试日期**：

### 测试结果汇总

- **总用例数**：15
- **通过数**：
- **失败数**：
- **通过率**：

### 发现的问题

| 问题 ID | 严重程度 | 问题描述 | 复现步骤 | 截图 |
|---------|----------|----------|----------|------|
| BUG-001 | 高/中/低 |  |  |  |

### 改进建议

1. 
2. 
3. 

### 测试结论

[ ] ✅ 通过，可以发布  
[ ] ⚠️ 部分问题，需修复后再测  
[ ] ❌ 未通过，需要大幅修改

---

## 📞 联系方式

如有问题，请联系开发团队。

---

**测试指南版本**：v1.0  
**最后更新**：2026年1月6日

